---
description: Discover React components in the project and assess Storybook story coverage. Shows what has stories, what's missing, and what's stale.
user-invocable: true
disable-model-invocation: true
argument-hint: "[directory or file path]"
---

# Storyteller Scan

Scan the project for React components and assess Storybook story coverage.

## Pre-flight Check

1. Check if `.storyteller/config.json` exists
2. If not, create it from `${CLAUDE_PLUGIN_ROOT}/templates/config.json` with sensible defaults
3. Read the config for `include_patterns` and `exclude_patterns`

## Phase 1: Configuration Detection

Before scanning components, detect the project's Storybook setup:

### Check for Storybook

Look for:
- `.storybook/` directory
- `storybook` in `package.json` dependencies/devDependencies
- Storybook scripts in `package.json`

If no Storybook setup found:
```
âš  No Storybook configuration detected.

Storyteller generates Storybook stories. You'll need Storybook installed:
  npx storybook@latest init

Continuing with component scan anyway...
```

### Detect Story Conventions

If existing stories are found, detect patterns:
- Are stories colocated with components or in a separate directory?
- What naming convention is used? (`.stories.tsx`, `.stories.ts`, `.story.tsx`)
- Are there global decorators in `.storybook/preview.tsx`?
- What Storybook version? (check package.json)

Update `.storyteller/config.json` with detected patterns.

## Phase 2: Component Discovery

### If path argument provided:

Scan only the specified path:
- If file: analyze that single component
- If directory: scan all components in that directory (recursive)

### If no path argument:

Use the scanner agent to scan the full project:

```
Task(subagent_type="storyteller-scanner", prompt="
Scan this project for React components.

Configuration:
{contents of .storyteller/config.json}

Include patterns: {include_patterns}
Exclude patterns: {exclude_patterns}

Find all React components, extract their prop types, and check which ones
have Storybook stories. Report the full inventory.
")
```

## Phase 3: Coverage Analysis

From the scanner results, compute:

- **Total components** found
- **With stories** â€” has a matching `.stories.tsx` file
- **Managed stories** â€” story file contains `@storyteller-managed`
- **Without stories** â€” no story file found
- **Possibly stale** â€” story exists but component has been modified more recently

## Phase 4: Report

### Summary Output

```
ðŸ“– Storyteller Scan Results

Components found: {total}
With stories:     {count} ({%})
  Managed:        {count} (auto-generated by storyteller)
  Custom:         {count} (hand-written)
Without stories:  {count}
Possibly stale:   {count}

{If include_patterns matched 0 files}
âš  No components matched the include patterns.
  Current patterns: {include_patterns}
  Try updating .storyteller/config.json with your component paths.
```

### Component List

```
Components without stories:
  âœ— src/components/Button.tsx (12 props)
  âœ— src/components/Card.tsx (8 props)
  âœ— src/components/Modal.tsx (15 props)

Components with stories:
  âœ“ src/components/Header.tsx â†’ Header.stories.tsx
  âœ“ src/components/Footer.tsx â†’ Footer.stories.tsx (managed)

Possibly stale:
  âš  src/components/Nav.tsx â€” component modified after story
    Props changed: +2 added, -1 removed
```

### Next Steps

```
Next steps:
  /storyteller:generate                          â†’ Generate stories for all uncovered components
  /storyteller:generate src/components/Button.tsx â†’ Generate for a specific component
  /storyteller:sync                              â†’ Update stale managed stories
  /storyteller:audit                             â†’ Full quality audit
```

## Phase 5: Save State

Write scan results to `.storyteller/last-scan.json`:
```json
{
  "timestamp": "{ISO timestamp}",
  "total_components": 0,
  "with_stories": 0,
  "without_stories": 0,
  "stale": 0,
  "components": [
    {
      "file": "src/components/Button.tsx",
      "name": "Button",
      "props_count": 12,
      "story_file": null,
      "managed": false,
      "stale": false
    }
  ]
}
```

## Edge Cases

- **No components found**: Report clearly, suggest checking include_patterns
- **No TypeScript**: Still works â€” just can't extract prop types as reliably
- **Monorepo**: Scan from current working directory, respect include_patterns
- **Component re-exports**: Track the source file, not the re-export
- **Multiple components in one file**: Track each component separately
